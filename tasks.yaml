# This tasks will be applied on controller nodes,
# here you can also specify several roles, for example
# ['cinder', 'compute'] will be applied only on
# cinder and compute nodes

- role: ['primary-controller']
  stage: post_deployment/6000
  type: shell
  parameters:
    cmd: sudo bash ./disable_pacemaker_neutron_services.sh
    timeout: 720
  fail_on_error: false

- role: ['primary-controller','controller']
  stage: post_deployment/6001
  type: puppet
  parameters:
    puppet_manifest: puppet/manifests/site-controller-post-1.pp
    puppet_modules: puppet/modules:/etc/puppet/modules
    timeout: 720

- role: ['primary-controller','controller']
  stage: post_deployment/6002
  type: puppet
  parameters:
    puppet_manifest: puppet/manifests/site-controller-post-2.pp
    puppet_modules: puppet/modules:/etc/puppet/modules
    timeout: 720

- role: ['primary-controller','controller']
  stage: post_deployment/6003
  type: puppet
  parameters:
    puppet_manifest: puppet/manifests/site-controller-post-3.pp
    puppet_modules: puppet/modules:/etc/puppet/modules
    timeout: 720

- role: ['primary-controller','controller']
  stage: post_deployment/6004
  type: puppet
  parameters:
    puppet_manifest: puppet/manifests/site-controller-post-4.pp
    puppet_modules: puppet/modules:/etc/puppet/modules
    timeout: 720

- role: ['primary-controller','controller']
  stage: post_deployment/6005
  type: puppet
  parameters:
    puppet_manifest: puppet/manifests/site-controller-post-5.pp
    puppet_modules: puppet/modules:/etc/puppet/modules
    timeout: 720

- role: ['primary-controller','controller']
  stage: post_deployment/6006
  type: puppet
  parameters:
    puppet_manifest: puppet/manifests/site-controller-post-6.pp
    puppet_modules: puppet/modules:/etc/puppet/modules
    timeout: 720

- role: ['compute']
  stage: post_deployment/6007
  type: puppet
  parameters:
    puppet_manifest: puppet/manifests/site-compute-post-1.pp
    puppet_modules: puppet/modules:/etc/puppet/modules
    timeout: 720

- role: ['compute']
  stage: post_deployment/6008
  type: puppet
  parameters:
    puppet_manifest: puppet/manifests/site-compute-post-2.pp
    puppet_modules: puppet/modules:/etc/puppet/modules
    timeout: 720

- role: ['compute']
  stage: post_deployment/6009
  type: puppet
  parameters:
    puppet_manifest: puppet/manifests/site-compute-post-3.pp
    puppet_modules: puppet/modules:/etc/puppet/modules
    timeout: 720

- role: ['compute']
  stage: post_deployment/6010
  type: shell
  parameters:
    cmd: sudo bash ./open_vxlan_ports.sh
    timeout: 720
  fail_on_error: false
